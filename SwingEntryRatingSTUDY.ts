# SWINGENTRYRATING
# WGRIFFITH2 (C) 2014

DECLARE LOWER;

INPUT KPERIOD = 40;
INPUT DPERIOD = 3;
INPUT RSI_SMA = 10;

# STOCHASTICSLOW
DEF FASTLINE = STOCHASTICSLOW("D PERIOD" = DPERIOD, "K PERIOD" = KPERIOD);
DEF SLOWLINE = STOCHASTICSLOW("D PERIOD" = DPERIOD, "K PERIOD" = KPERIOD).SLOWD;

#RSI
DEF NETCHGAVG = WILDERSAVERAGE(CLOSE - CLOSE[1], 14);
DEF TOTCHGAVG = WILDERSAVERAGE(ABSVALUE(CLOSE - CLOSE[1]), 14);
DEF CHGRATIO = IF TOTCHGAVG != 0 THEN NETCHGAVG / TOTCHGAVG ELSE 0;
DEF RSI = ROUND(50 * (CHGRATIO + 1), NUMBEROFDIGITS = 0);
DEF SMA = ROUND(SIMPLEMOVINGAVG(PRICE = RSI, LENGTH = RSI_SMA), 0);

# TEST
DEF GREENPRICE = FASTLINE >= SLOWLINE AND RSI >= SMA;
DEF REDPRICE = FASTLINE < SLOWLINE AND RSI <= SMA;

PLOT RATING =

IF
GREENPRICE
AND CLOSE >= OHLC4[1]
AND LOWEST(FASTLINE[1],2) <= 20
THEN 1

ELSE IF
REDPRICE
AND CLOSE <= OHLC4[1]
AND HIGHEST(FASTLINE[1],2) >= 80
THEN -1

ELSE 0;